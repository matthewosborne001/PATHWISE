<script>

let assessments = JSON.parse(localStorage.getItem("assessments")) || [];

function openModal(){
document.getElementById("modal").style.display="flex";
}

function closeModal(){
document.getElementById("modal").style.display="none";
}

function saveAssessment(){

let age=parseInt(document.getElementById("age").value);
let subject=document.getElementById("subject").value.trim();
let deadlineInput=document.getElementById("deadline").value;
let difficulty=parseInt(document.getElementById("difficulty").value);

if(!age || !subject || !deadlineInput || !difficulty){
alert("Please complete all fields.");
return;
}

if(difficulty < 1 || difficulty > 10){
alert("Difficulty must be between 1 and 10.");
return;
}

let deadline=new Date(deadlineInput);
let today=new Date();

let timeDiff=deadline - today;
let daysRemaining=Math.ceil(timeDiff/(1000*60*60*24));

if(isNaN(daysRemaining) || daysRemaining <= 1){
daysRemaining = 2;
}

/* AGE-BASED DAILY CAP */

let dailyCap;

if(age <= 12) dailyCap = 1.5;
else if(age <= 15) dailyCap = 2;
else if(age <= 18) dailyCap = 3;
else dailyCap = 4;

/* NEW REALISTIC TOTAL HOURS */
let totalHours = difficulty * 1.5;

/* REST DAY LOGIC */
let weeks = Math.floor(daysRemaining / 7);
let restDays = weeks >= 1 ? weeks : 0;

let studyDays = daysRemaining - restDays;
if(studyDays < 1) studyDays = 1;

/* DISTRIBUTION */
let dailyHours = totalHours / studyDays;

/* ENFORCE CAP */
if(dailyHours > dailyCap){
dailyHours = dailyCap;
}

/* HARD SAFETY LIMIT */
if(dailyHours > 6){
dailyHours = 6;
}

let plan = {
subject,
age,
difficulty,
daysRemaining,
dailyHours: parseFloat(dailyHours.toFixed(2))
};

assessments.push(plan);
localStorage.setItem("assessments", JSON.stringify(assessments));

renderAssessments();
closeModal();
}

function renderAssessments(){

let list=document.getElementById("assessmentList");

if(assessments.length === 0){
list.innerHTML="No assessments yet.";
document.getElementById("workloadInfo").innerText="No workload calculated yet.";
document.getElementById("riskInfo").innerText="No risk detected.";
return;
}

list.innerHTML="";

assessments.forEach(a=>{
list.innerHTML += `
<div>
<strong>${a.subject}</strong><br>
Age: ${a.age} | ${a.dailyHours}h/day | ${a.daysRemaining} days left
<hr>
</div>
`;
});

/* TOTAL DAILY LOAD */
let totalDaily = assessments.reduce((sum,a)=>sum + a.dailyHours,0);

/* GLOBAL SAFETY LIMIT */
if(totalDaily > 6){
totalDaily = 6;
}

document.getElementById("workloadInfo").innerText =
"Estimated daily total: " + totalDaily.toFixed(2) + "h";

/* RISK LOGIC */

if(totalDaily > 4){
document.getElementById("riskInfo").innerText = "âš  Overload risk detected.";
}
else if(totalDaily > 2.5){
document.getElementById("riskInfo").innerText = "Moderate workload.";
}
else{
document.getElementById("riskInfo").innerText = "Healthy workload.";
}

}

renderAssessments();

</script>
