<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Layer 2 — Weekly Intelligence System</title>

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:'Segoe UI',sans-serif;
}

body{
  background:linear-gradient(135deg,#0f1f3d,#1c2f57);
  color:white;
}

.frame{
  border:2px solid #d4af37;
  border-radius:25px;
  margin:15px;
  min-height:calc(100vh - 30px);
  padding:60px 40px;
}

h1{
  text-align:center;
  font-size:42px;
  margin-bottom:20px;
}

.stress{
  text-align:center;
  margin-bottom:50px;
  font-size:20px;
}

.badge{
  display:inline-block;
  padding:8px 16px;
  border-radius:20px;
  font-weight:bold;
}

.green{ background:#2ecc71; }
.yellow{ background:#f1c40f; }
.red{ background:#c0392b; }

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:40px;
}

.card{
  background:rgba(255,255,255,0.05);
  padding:30px;
  border-radius:18px;
}

.card h2{
  color:#f4b942;
  margin-bottom:20px;
}

.bar{
  margin-bottom:15px;
}

.bar-fill{
  height:10px;
  background:linear-gradient(45deg,#f4b942,#e0a22f);
  border-radius:5px;
}

.alert{
  margin-bottom:10px;
  font-size:14px;
}

.back{
  text-align:center;
  margin-top:50px;
}

.back a{
  color:#f4b942;
  text-decoration:none;
}
</style>
</head>

<body>

<div class="frame">

<h1>Layer 2 — Weekly Intelligence System</h1>

<div class="stress">
  Weekly Stress Index:
  <span id="stressBadge" class="badge">Calculating...</span>
</div>

<div class="grid">

  <div class="card">
    <h2>Weekly Distribution</h2>
    <div id="weeklyBars"></div>
  </div>

  <div class="card">
    <h2>Overload Analysis</h2>
    <div id="alerts"></div>
  </div>

</div>

<div class="back">
  <a href="plus.html">← Back to Plus</a>
</div>

</div>

<script>

function loadWeeklyData(){

  const assessments = JSON.parse(localStorage.getItem("assessments")) || [];

  const weeklyBars = document.getElementById("weeklyBars");
  const alerts = document.getElementById("alerts");
  const stressBadge = document.getElementById("stressBadge");

  weeklyBars.innerHTML = "";
  alerts.innerHTML = "";

  if(assessments.length === 0){
    weeklyBars.innerHTML = "No assessments saved.";
    stressBadge.textContent = "0%";
    stressBadge.className = "badge green";
    return;
  }

  let totalDaily = 0;

  assessments.forEach(a=>{
    totalDaily += parseFloat(a.dailyStudy);
  });

  // distribute evenly across 7 days
  let dailyHours = totalDaily;
  if(dailyHours > 8) dailyHours = 8; // hard cap

  const days = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];

  days.forEach(day=>{
    const barContainer = document.createElement("div");
    barContainer.className = "bar";
    barContainer.innerHTML = `
      ${day} – ${dailyHours.toFixed(1)}h
      <div class="bar-fill" style="width:${dailyHours*10}%"></div>
    `;
    weeklyBars.appendChild(barContainer);

    if(dailyHours > 4){
      const alert = document.createElement("div");
      alert.className = "alert";
      alert.textContent = "⚠ " + day + " exceeds healthy limit.";
      alerts.appendChild(alert);
    }
  });

  const stressPercent = Math.min((dailyHours / 4) * 100, 200);

  if(stressPercent < 60){
    stressBadge.textContent = "Controlled (" + stressPercent.toFixed(0) + "%)";
    stressBadge.className = "badge green";
  }
  else if(stressPercent < 100){
    stressBadge.textContent = "Elevated (" + stressPercent.toFixed(0) + "%)";
    stressBadge.className = "badge yellow";
  }
  else{
    stressBadge.textContent = "Critical (" + stressPercent.toFixed(0) + "%)";
    stressBadge.className = "badge red";
  }
}

loadWeeklyData();

</script>

</body>
</html>
